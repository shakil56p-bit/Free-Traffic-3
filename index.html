<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Free Traffic - Secure Panel</title>
    
    <link rel="stylesheet" href="style.css">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>

    <div id="auth-section" class="container">
        <br><br>
        <h1 class="neon-text">CPA PRO</h1>
        <p style="color: #aaa;">‡¶∏‡¶ø‡¶ï‡¶ø‡¶â‡¶∞ ‡¶ü‡ßç‡¶∞‡¶æ‡¶´‡¶ø‡¶ï ‡¶è‡¶ï‡ßç‡¶∏‡¶ö‡ßá‡¶û‡ßç‡¶ú</p>
        <br>
        
        <div id="login-form">
            <h3 style="color: #00d4ff;">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
            <div class="input-group">
                <i class="fas fa-envelope"></i>
                <input type="email" id="loginEmail" placeholder="‡¶á‡¶Æ‡ßá‡¶á‡¶≤">
            </div>
            <div class="input-group">
                <i class="fas fa-key"></i>
                <input type="password" id="loginPass" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°">
            </div>
            <button onclick="handleLogin()" class="btn-primary">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            <p style="margin-top:15px; font-size:12px;">‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶®‡ßá‡¶á? <span onclick="toggleAuth('register')" style="color: #d000ff; cursor: pointer;">‡¶®‡¶§‡ßÅ‡¶® ‡¶Ü‡¶á‡¶°‡¶ø ‡¶ñ‡ßÅ‡¶≤‡ßÅ‡¶®</span></p>
        </div>

        <div id="register-form" class="hidden">
            <h3 style="color: #d000ff;">‡¶®‡¶§‡ßÅ‡¶® ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü</h3>
            <div class="input-group">
                <i class="fas fa-envelope"></i>
                <input type="email" id="regEmail" placeholder="‡¶á‡¶Æ‡ßá‡¶á‡¶≤">
            </div>
            <div class="input-group">
                <i class="fas fa-lock"></i>
                <input type="password" id="regPass" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° (‡ß¨ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ)">
            </div>
            <button onclick="handleRegister()" class="btn-primary">‡¶∏‡¶æ‡¶á‡¶® ‡¶Ü‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            <p style="margin-top:15px; font-size:12px;">‡¶Ü‡¶ó‡ßá‡¶á ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶Ü‡¶õ‡ßá? <span onclick="toggleAuth('login')" style="color: #00d4ff; cursor: pointer;">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</span></p>
        </div>
    </div>

    <div id="dashboard-section" class="container hidden">
        <div class="header">
            <div class="profile-pic">
                <i class="fas fa-user-astronaut"></i>
            </div>
            <div class="user-info" style="text-align: left;">
                <h3 id="user-name" style="margin:0; font-family:'Orbitron', sans-serif;">User</h3>
                <span style="font-size:10px; color:#00ff88;">‚óè ‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶®</span><br>
                <div class="balance-badge">ü™ô <span id="user-balance">0.00</span></div>
            </div>
        </div>

        <h3 class="neon-text" style="font-size: 18px;">‡¶ï‡¶Æ‡¶æ‡¶®‡ßç‡¶° ‡¶∏‡ßá‡¶®‡ßç‡¶ü‡¶æ‡¶∞</h3>
        <div class="grid-menu">
            <div class="card" onclick="openSection('exchange')">
                <i class="fas fa-exchange-alt color-cyan"></i><p>‡¶è‡¶ï‡ßç‡¶∏‡¶ö‡ßá‡¶û‡ßç‡¶ú</p>
            </div>
            <div class="card" onclick="openSection('myads')">
                <i class="fas fa-bullhorn color-purple"></i><p>‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡¶ø‡¶®</p>
            </div>
            <div class="card" onclick="openSection('profile')">
                <i class="fas fa-user color-red"></i><p>‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</p>
            </div>
            <div class="card" onclick="claimDailyBonus()">
                <i class="fas fa-gift color-yellow"></i><p>‡¶¨‡ßã‡¶®‡¶æ‡¶∏</p>
            </div>
            <div class="card" onclick="openSection('sendmoney')">
                <i class="fas fa-paper-plane color-green"></i><p>‡¶∏‡ßá‡¶®‡ßç‡¶° ‡¶Æ‡¶æ‡¶®‡¶ø</p>
            </div>
            <div class="card" onclick="Swal.fire('Info', 'Admin: shakil56p@gmail.com', 'info')">
                <i class="fas fa-headset color-blue"></i><p>‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü</p>
            </div>
        </div>

        <div id="content-area" class="content-box hidden">
            <button onclick="closeContent()" class="close-btn">X</button>
            <div id="dynamic-body"></div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
        // ‚ö†Ô∏è ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ Firebase Config ‡¶®‡¶ø‡¶ö‡ßá ‡¶¨‡¶∏‡¶æ‡¶® ‚ö†Ô∏è
        const firebaseConfig = {
            apiKey: "AIzaSyDjQ0LB1J1MeAFyPOdA9sCkYiPYaT4rXEg",
            authDomain: "free-traffic-b363b.firebaseapp.com",
            databaseURL: "https://free-traffic-b363b-default-rtdb.firebaseio.com",
            projectId: "free-traffic-b363b",
            storageBucket: "free-traffic-b363b.firebasestorage.app",
            messagingSenderId: "800542824235",
            appId: "1:800542824235:web:8283a6df589af8651cd76e",
            measurementId: "G-LMVTZKVNJZ"
        };
        
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();
        let currentUser = null;

        // --- ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶ø‡¶Ç (Link Catching) ---
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const refID = urlParams.get('ref');
            if (refID) {
                // ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞‡ßá ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßá ‡¶∞‡¶æ‡¶ñ‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
                sessionStorage.setItem('referrer', refID);
            }
        };

        // --- IP ‡¶¨‡ßá‡¶∞ ‡¶ï‡¶∞‡¶æ ---
        async function getIP() {
            try {
               const r = await fetch('https://api.ipify.org?format=json');
               const d = await r.json();
               return d.ip.replace(/\./g, '_');
            } catch (e) { return "unknown_ip"; }
        }

        // --- ‡¶ü‡¶ó‡¶≤ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ---
        function toggleAuth(view) {
            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('register-form').classList.add('hidden');
            document.getElementById(view + '-form').classList.remove('hidden');
        }

        // --- ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® (‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶∏‡¶π) ---
        async function handleRegister() {
            const email = document.getElementById('regEmail').value;
            const pass = document.getElementById('regPass').value;
            
            if(!email || !pass) return Swal.fire('Error', '‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®', 'error');
            if(pass.length < 6) return Swal.fire('Error', '‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶õ‡ßã‡¶ü', 'warning');

            Swal.showLoading();
            const ip = await getIP();

            db.ref('ips/' + ip).once('value', s => {
                if (s.exists()) {
                    Swal.fire('Error', '‡¶è‡¶á ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏‡ßá ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶Ü‡¶õ‡ßá!', 'error');
                } else {
                    auth.createUserWithEmailAndPassword(email, pass).then(c => {
                        const uid = c.user.uid;
                        
                        // ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶≤‡¶ú‡¶ø‡¶ï
                        const referrer = sessionStorage.getItem('referrer');
                        if(referrer && referrer !== uid) {
                            // ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡¶æ‡¶∞‡¶ï‡ßá ‡ß®‡ß´ ‡¶ï‡ßü‡ßá‡¶® ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
                            db.ref('users/' + referrer + '/balance').transaction(bal => (bal || 0) + 25);
                        }

                        // ‡¶®‡¶§‡ßÅ‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶∏‡ßá‡¶≠
                        db.ref('users/' + uid).set({
                            email: email,
                            balance: 0,
                            uid: uid,
                            ip: ip,
                            lastBonus: 0,
                            referredBy: referrer || 'none'
                        });
                        
                        db.ref('ips/' + ip).set(uid);
                        Swal.fire('Success', '‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶ñ‡ßã‡¶≤‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!', 'success');
                    }).catch(e => Swal.fire('Error', e.message, 'error'));
                }
            });
        }

        // --- ‡¶≤‡¶ó‡¶á‡¶® ---
        function handleLogin() {
            const email = document.getElementById('loginEmail').value;
            const pass = document.getElementById('loginPass').value;
            
            if(!email || !pass) return Swal.fire('Error', '‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®', 'warning');
            
            Swal.showLoading();
            auth.signInWithEmailAndPassword(email, pass)
                .then(() => Swal.fire('Success', '‡¶≤‡¶ó‡¶á‡¶® ‡¶∏‡¶´‡¶≤!', 'success'))
                .catch(e => Swal.fire('Error', '‡¶≠‡ßÅ‡¶≤ ‡¶§‡¶•‡ßç‡¶Ø!', 'error'));
        }

        auth.onAuthStateChanged(user => {
            if (user) {
                currentUser = user;
                document.getElementById('auth-section').style.display = 'none';
                document.getElementById('dashboard-section').classList.remove('hidden');
                
                db.ref('users/' + user.uid).on('value', s => {
                    const d = s.val();
                    if(d) {
                        const bal = parseFloat(d.balance) || 0;
                        document.getElementById('user-balance').innerText = bal.toFixed(2);
                        document.getElementById('user-name').innerText = d.email.split('@')[0];
                    }
                });
            } else {
                document.getElementById('auth-section').style.display = 'block';
                document.getElementById('dashboard-section').classList.add('hidden');
            }
        });

        // --- ‡¶®‡ßá‡¶≠‡¶ø‡¶ó‡ßá‡¶∂‡¶® ---
        function openSection(name) {
            document.getElementById('content-area').classList.remove('hidden');
            const body = document.getElementById('dynamic-body');
            
            if(name === 'exchange') loadExchange(body);
            else if(name === 'myads') loadMyAds(body);
            else if(name === 'sendmoney') loadSendMoney(body);
            else if(name === 'profile') {
                // ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤‡ßá ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
                const refLink = window.location.href.split('?')[0] + '?ref=' + currentUser.uid;
                
                body.innerHTML = `
                    <h3>‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</h3>
                    <p>${currentUser.email}</p>
                    
                    <div style="background:#111; padding:10px; margin:10px 0; border-radius:5px;">
                        <small style="color:#aaa">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï (‡ß®‡ß´ ‡¶ï‡ßü‡ßá‡¶®/‡¶∞‡ßá‡¶´‡¶æ‡¶∞):</small>
                        <input type="text" value="${refLink}" class="input-full" style="font-size:12px; text-align:center;" readonly onclick="this.select(); document.execCommand('copy'); Swal.fire('‡¶ï‡¶™‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá!', '', 'success')">
                        <p style="font-size:10px; color:yellow;">‡¶≤‡¶ø‡¶Ç‡¶ï‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                    </div>

                    <button onclick="auth.signOut()" class="btn-primary" style="background:red">‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>
                `;
            }
        }
        function closeContent() { document.getElementById('content-area').classList.add('hidden'); }

        // --- ‡¶è‡¶ï‡ßç‡¶∏‡¶ö‡ßá‡¶û‡ßç‡¶ú ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ---
        function loadExchange(c) {
            c.innerHTML = `
                <h3 class="neon-text">‡¶ü‡ßç‡¶∞‡¶æ‡¶´‡¶ø‡¶ï ‡¶è‡¶ï‡ßç‡¶∏‡¶ö‡ßá‡¶û‡ßç‡¶ú</h3>
                <div class="cat-btn-group">
                    <button class="cat-btn cat-active" onclick="filterTasks('Direct Link', this)">Direct</button>
                    <button class="cat-btn" onclick="filterTasks('Website', this)">Web</button>
                    <button class="cat-btn" onclick="filterTasks('Ad Script', this)">Script</button>
                </div>
                <div id="taskList">‡¶ñ‡ßÅ‡¶Å‡¶ú‡¶õ‡ßá...</div>
            `;
            filterTasks('Direct Link', document.querySelector('.cat-btn'));
        }

        function filterTasks(cat, el) {
            if(el) { 
                document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('cat-active'));
                el.classList.add('cat-active');
            }
            const list = document.getElementById('taskList');
            list.innerHTML = '<p style="text-align:center">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>';

            db.ref('tasks').on('value', snap => {
                let html = '';
                snap.forEach(child => {
                    const task = child.val();
                    const taskId = child.key;
                    const rem = parseInt(task.remaining);
                    const viewedBy = task.viewedBy || {};
                    const hasSeen = viewedBy.hasOwnProperty(currentUser.uid);

                    if(rem > 0 && task.owner !== currentUser.uid && (task.type || 'Direct Link') === cat && !hasSeen) {
                        const reward = task.duration / 10;
                        html += `
                        <div class="task-card">
                            <div>
                                <h4 style="margin:0;color:#00d4ff;font-size:14px">TASK</h4>
                                <small style="color:#aaa">${task.duration} ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° | ${reward} ‡¶ï‡ßü‡ßá‡¶®</small>
                            </div>
                            <button onclick="startTask('${taskId}', '${task.url}', ${task.duration}, ${reward})" class="btn-primary" style="width:auto; padding:5px 15px; margin:0; font-size:12px">View</button>
                        </div>`;
                    }
                });
                list.innerHTML = html || '<p style="text-align:center; color:red">‡¶ï‡ßã‡¶®‡ßã ‡¶ï‡¶æ‡¶ú ‡¶®‡ßá‡¶á‡•§</p>';
            });
        }

        function startTask(taskId, url, duration, reward) {
            window.open(url, '_blank'); 
            const endTime = Date.now() + (duration * 1000);
            let timerInterval;

            Swal.fire({
                title: '‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®',
                html: `‡¶∏‡¶Æ‡ßü ‡¶¨‡¶æ‡¶ï‡¶ø: <b id="timer-display">${duration}</b> ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°`,
                allowOutsideClick: false,
                showConfirmButton: false,
                didOpen: () => {
                    timerInterval = setInterval(() => {
                        const remaining = Math.ceil((endTime - Date.now()) / 1000);
                        const display = document.getElementById('timer-display');
                        if(display) display.innerText = remaining > 0 ? remaining : 0;

                        if(remaining <= 0) {
                            clearInterval(timerInterval);
                            Swal.close();
                            completeTask(taskId, reward); 
                        }
                    }, 1000);
                },
                willClose: () => clearInterval(timerInterval)
            });
        }

        function completeTask(taskId, reward) {
            const userRef = db.ref('users/' + currentUser.uid);
            userRef.once('value', s => {
                const curBal = parseFloat(s.val().balance) || 0;
                userRef.update({ balance: curBal + parseFloat(reward) }).then(() => {
                    const taskRef = db.ref('tasks/' + taskId);
                    taskRef.child('remaining').transaction(rem => (rem > 0 ? rem - 1 : 0));
                    taskRef.child('viewedBy').child(currentUser.uid).set(true);
                    Swal.fire({icon: 'success', title: '‡¶Ö‡¶≠‡¶ø‡¶®‡¶®‡ßç‡¶¶‡¶®!', text: `${reward} ‡¶ï‡ßü‡ßá‡¶® ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡ßü‡ßá‡¶õ‡ßá`, timer: 2000});
                });
            });
        }

        // --- ‡¶Æ‡¶æ‡¶á ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶∏ ---
        function loadMyAds(c) {
            c.innerHTML = `
                <h3>‡¶®‡¶§‡ßÅ‡¶® ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶®</h3>
                <input type="text" id="adUrl" placeholder="‡¶≤‡¶ø‡¶Ç‡¶ï (https://)" class="input-full">
                
                <select id="adTime" class="input-full" onchange="calcCost()">
                    <option value="10">‡ßß‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° (‡ßß ‡¶ï‡ßü‡ßá‡¶®)</option>
                    <option value="20">‡ß®‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° (‡ß® ‡¶ï‡ßü‡ßá‡¶®)</option>
                    <option value="30">‡ß©‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° (‡ß© ‡¶ï‡ßü‡ßá‡¶®)</option>
                    <option value="40">‡ß™‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° (‡ß™ ‡¶ï‡ßü‡ßá‡¶®)</option>
                    <option value="50">‡ß´‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° (‡ß´ ‡¶ï‡ßü‡ßá‡¶®)</option>
                    <option value="60">‡ß¨‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° (‡ß¨ ‡¶ï‡ßü‡ßá‡¶®)</option>
                </select>

                <select id="adType" class="input-full">
                    <option value="Direct Link">Direct Link</option>
                    <option value="Website">Website</option>
                    <option value="Ad Script">Script</option>
                </select>

                <input type="number" id="adTarget" placeholder="‡¶ï‡¶§ ‡¶≠‡¶ø‡¶â ‡¶≤‡¶æ‡¶ó‡¶¨‡ßá?" class="input-full" onkeyup="calcCost()">
                <p id="costDisplay" style="color:yellow; text-align:center; font-size:12px">‡¶ñ‡¶∞‡¶ö: 0.00</p>
                <button onclick="postAd()" class="btn-primary">‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                <hr style="border-color:#333; margin:20px 0;">
                <h3>‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø</h3>
                <div id="historyList">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
            `;
            loadHistory();
        }

        function loadHistory() {
            db.ref('tasks').orderByChild('owner').equalTo(currentUser.uid).on('value', snap => {
                let html = '';
                if(snap.exists()) {
                    const arr = [];
                    snap.forEach(c => arr.push(c.val()));
                    arr.reverse().forEach(t => {
                        const init = parseInt(t.initialTarget || t.remaining);
                        const rem = parseInt(t.remaining);
                        const done = init - rem;
                        const isDone = rem <= 0;
                        html += `
                        <div class="history-card">
                            <span class="status-badge ${isDone?'status-done':'status-active'}">${isDone ? 'COMPLETED' : 'RUNNING'}</span>
                            <span class="progress-text">‡¶≠‡¶ø‡¶â: ${done}/${init}</span>
                            <div style="margin-top:5px; overflow:hidden; text-overflow:ellipsis; color:#00d4ff; font-size:12px;"><i class="fas fa-link"></i> ${t.url}</div>
                        </div>`;
                    });
                }
                document.getElementById('historyList').innerHTML = html || '<p style="text-align:center">‡¶ï‡ßã‡¶®‡ßã ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶®‡ßá‡¶á‡•§</p>';
            });
        }

        function calcCost() {
            const time = document.getElementById('adTime').value;
            const view = document.getElementById('adTarget').value;
            const cost = (time / 10) * view;
            document.getElementById('costDisplay').innerText = `‡¶ñ‡¶∞‡¶ö: ${cost.toFixed(2)} ‡¶ï‡ßü‡ßá‡¶®`;
        }

        function postAd() {
            const url = document.getElementById('adUrl').value;
            const time = document.getElementById('adTime').value;
            const target = document.getElementById('adTarget').value;
            const type = document.getElementById('adType').value;
            const cost = (time / 10) * target;

            if(!url || !target) return Swal.fire('Error', '‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®', 'error');

            db.ref('users/' + currentUser.uid).once('value', s => {
                const bal = parseFloat(s.val().balance) || 0;
                if(bal >= cost) {
                    db.ref('users/' + currentUser.uid + '/balance').set(bal - cost);
                    db.ref('tasks').push({
                        owner: currentUser.uid, url, duration: time, remaining: target, initialTarget: target, type, viewedBy: {}
                    });
                    Swal.fire('Success', '‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶π‡ßü‡ßá‡¶õ‡ßá!', 'success');
                } else {
                    Swal.fire('Error', '‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶®‡ßá‡¶á!', 'error');
                }
            });
        }

        // --- ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ---
        function claimDailyBonus() {
             const now = Date.now();
             db.ref('users/' + currentUser.uid).once('value', s => {
                 if(now - (s.val().lastBonus||0) > 86400000) { 
                     db.ref('users/'+currentUser.uid+'/balance').set(parseFloat(s.val().balance||0) + 5);
                     db.ref('users/'+currentUser.uid+'/lastBonus').set(now);
                     Swal.fire('Success', '‡ß´ ‡¶ï‡ßü‡ßá‡¶® ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶™‡ßá‡ßü‡ßá‡¶õ‡ßá‡¶®!', 'success');
                 } else Swal.fire('Wait', '‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶®‡ßá‡¶ì‡ßü‡¶æ ‡¶∂‡ßá‡¶∑‡•§', 'info');
             });
        }

        // --- ‡¶∏‡ßá‡¶®‡ßç‡¶° ‡¶Æ‡¶æ‡¶®‡¶ø ---
        function loadSendMoney(c) {
            c.innerHTML = `<h3>‡¶∏‡ßá‡¶®‡ßç‡¶° ‡¶Æ‡¶æ‡¶®‡¶ø</h3><input id="rx" placeholder="Email" class="input-full"><input id="am" placeholder="Amount" class="input-full"><button onclick="send()" class="btn-primary">‡¶™‡¶æ‡¶†‡¶æ‡¶®</button>`;
        }
        function send() {
            const rx = document.getElementById('rx').value;
            const am = parseFloat(document.getElementById('am').value);
            
            db.ref('users/' + currentUser.uid).once('value', s => {
                if(parseFloat(s.val().balance||0) >= am) {
                    db.ref('users').orderByChild('email').equalTo(rx).once('value', r => {
                        if(r.exists()) {
                            const k = Object.keys(r.val())[0];
                            db.ref('users/'+currentUser.uid+'/balance').set(parseFloat(s.val().balance) - am);
                            db.ref('users/'+k+'/balance').set(parseFloat(r.val()[k].balance) + am);
                            Swal.fire('Success', '‡¶∏‡ßá‡¶®‡ßç‡¶° ‡¶∏‡¶´‡¶≤!', 'success');
                        } else Swal.fire('Error', '‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø', 'error');
                    });
                } else Swal.fire('Error', '‡¶ü‡¶æ‡¶ï‡¶æ ‡¶®‡ßá‡¶á', 'error');
            });
        }
    </script>
</body>
</html>
